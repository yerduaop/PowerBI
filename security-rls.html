<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SÃ©curitÃ© & RLS - Guide Power BI</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="page-header">
        <div class="header-content">
            <h1 class="page-title">ğŸ”’ SÃ©curitÃ© & RLS</h1>
            <p class="page-subtitle">Row-Level Security et bonnes pratiques de sÃ©curitÃ©</p>
        </div>
    </header>
    
    <nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="index.html">ğŸ  Accueil</a>
            <span>â€º</span>
            <span>SÃ©curitÃ© & RLS</span>
        </div>
    </nav>
    
    <div class="container">
        <div class="level-badge level-expert">
            ğŸ”´ Niveau Expert â€¢ â±ï¸ 45 min de lecture
        </div>
        
        <!-- INTRODUCTION RLS -->
        <section class="section">
            <div class="section-header">
                <span class="section-icon">ğŸ”</span>
                <h2 class="section-title">Row-Level Security (RLS)</h2>
            </div>
            
            <div class="info-box info-box-definition">
                <div class="info-box-title">ğŸ’¡ Qu'est-ce que RLS ?</div>
                <p><strong>Row-Level Security (RLS)</strong> = Filtrer automatiquement les donnÃ©es selon l'utilisateur connectÃ©</p>
                <p style="margin-top: 1rem;"><strong>Exemple :</strong> Managers ne voient QUE leur rÃ©gion, pas les autres rÃ©gions</p>
            </div>
            
            <div class="info-box info-box-warning">
                <div class="info-box-title">âš ï¸ RLS ne fonctionne PAS dans Power BI Desktop</div>
                <p>RLS s'active UNIQUEMENT dans Power BI Service aprÃ¨s publication</p>
                <p style="margin-top: 0.5rem;"><strong>Pour tester :</strong> Modeling > View as Roles dans Desktop</p>
            </div>
        </section>
        
        <!-- MÃ‰THODES RLS -->
        <section class="section">
            <div class="section-header">
                <span class="section-icon">ğŸ¯</span>
                <h2 class="section-title">MÃ©thodes d'ImplÃ©mentation RLS</h2>
            </div>
            
            <h3 style="color: var(--primary); margin: 1.5rem 0 1rem;">MÃ©thode 1 : RLS Statique (Simple)</h3>
            
            <div class="code-block">
<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‰TAPE 1 : CrÃ©er RÃ´le dans Power BI Desktop
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Modeling > Manage Roles > New</span>

<span class="code-comment">// ROLE : France Only</span>
<span class="code-comment">// Table : DimGeography</span>
<span class="code-comment">// Filter : [Country] = "France"</span>

[Country] = <span class="code-string">"France"</span>

<span class="code-comment">// ROLE : Germany Only</span>
[Country] = <span class="code-string">"Germany"</span>

<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‰TAPE 2 : Tester dans Desktop
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Modeling > View as > Select role "France Only"</span>
<span class="code-comment">// â†’ VÃ©rifier que seules donnÃ©es France visibles</span>

<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‰TAPE 3 : Publier et assigner utilisateurs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// 1. Publier rapport vers Power BI Service
// 2. Dans Service > Dataset > Security
// 3. Assigner utilisateurs/groupes aux rÃ´les:
//    - Role "France Only" â†’ Groupe "France Managers"
//    - Role "Germany Only" â†’ Groupe "Germany Managers"</span>
            </div>
            
            <h3 style="color: var(--primary); margin: 2rem 0 1rem;">MÃ©thode 2 : RLS Dynamique (AvancÃ©)</h3>
            
            <div class="info-box info-box-tip">
                <div class="info-box-title">ğŸ¯ Pourquoi RLS Dynamique ?</div>
                <p><strong>ProblÃ¨me RLS Statique :</strong> 1 rÃ´le par rÃ©gion = 100 rÃ©gions = 100 rÃ´les !</p>
                <p><strong>Solution RLS Dynamique :</strong> 1 seul rÃ´le qui s'adapte automatiquement</p>
            </div>
            
            <div class="code-block">
<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‰TAPE 1 : CrÃ©er table de mapping User-Region
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Table : UserRegionMapping</span>
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Email                        â•‘ Region   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•£
â•‘ john@company.com             â•‘ France   â•‘
â•‘ marie@company.com            â•‘ Germany  â•‘
â•‘ paul@company.com             â•‘ Spain    â•‘
â•‘ admin@company.com            â•‘ *        â•‘ <span class="code-comment">// Admin voit tout</span>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•

<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‰TAPE 2 : CrÃ©er relation
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

UserRegionMapping[Region] â”€â”€(1:*)â”€â”€> DimGeography[Region]

<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‰TAPE 3 : CrÃ©er UNIQUE RÃ´le "Dynamic RLS"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Table : UserRegionMapping</span>
<span class="code-comment">// DAX Filter Expression:</span>

[Email] = <span class="code-function">USERPRINCIPALNAME</span>()

<span class="code-comment">// OU avec support admin (*)</span>

[Email] = <span class="code-function">USERPRINCIPALNAME</span>() 
    <span class="code-keyword">|| </span>[Region] = <span class="code-string">"*"</span>

<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FONCTIONNEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Utilisateur john@company.com se connecte:</span>
<span class="code-comment">// 1. USERPRINCIPALNAME() retourne "john@company.com"</span>
<span class="code-comment">// 2. Filtre UserRegionMapping â†’ Ligne oÃ¹ Email = "john@company.com"</span>
<span class="code-comment">// 3. Relation propage filtre â†’ Region = "France"</span>
<span class="code-comment">// 4. Toutes donnÃ©es filtrÃ©es automatiquement sur France</span>
            </div>
            
            <h3 style="color: var(--primary); margin: 2rem 0 1rem;">MÃ©thode 3 : RLS Multi-Niveaux</h3>
            
            <div class="code-block">
<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCÃ‰NARIO : HiÃ©rarchie d'accÃ¨s
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// - CEO : Voit tout
// - Regional Manager : Voit sa rÃ©gion
// - Store Manager : Voit son magasin uniquement</span>

<span class="code-comment">// Table : UserAccess</span>
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Email          â•‘ Level      â•‘ Region   â•‘ StoreID   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ceo@c.com      â•‘ CEO        â•‘ *        â•‘ *         â•‘
â•‘ mgr@c.com      â•‘ Regional   â•‘ France   â•‘ *         â•‘
â•‘ store@c.com    â•‘ Store      â•‘ France   â•‘ 101       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•

<span class="code-comment">// RÃ´le DAX sur DimStore:</span>

<span class="code-keyword">VAR</span> UserEmail = <span class="code-function">USERPRINCIPALNAME</span>()
<span class="code-keyword">VAR</span> UserLevel = 
    <span class="code-function">LOOKUPVALUE</span>(
        UserAccess[Level],
        UserAccess[Email], UserEmail
    )
<span class="code-keyword">VAR</span> UserRegion = 
    <span class="code-function">LOOKUPVALUE</span>(
        UserAccess[Region],
        UserAccess[Email], UserEmail
    )
<span class="code-keyword">VAR</span> UserStore = 
    <span class="code-function">LOOKUPVALUE</span>(
        UserAccess[StoreID],
        UserAccess[Email], UserEmail
    )
<span class="code-keyword">RETURN</span>
    <span class="code-function">SWITCH</span>(
        UserLevel,
        <span class="code-string">"CEO"</span>, <span class="code-keyword">TRUE</span>(),  <span class="code-comment">// Voit tout</span>
        <span class="code-string">"Regional"</span>, [Region] = UserRegion <span class="code-keyword">|| </span>UserRegion = <span class="code-string">"*"</span>,
        <span class="code-string">"Store"</span>, [StoreID] = UserStore,
        <span class="code-keyword">FALSE</span>()  <span class="code-comment">// Par dÃ©faut : rien</span>
    )
            </div>
        </section>
        
        <!-- PATTERNS RLS AVANCÃ‰S -->
        <section class="section">
            <div class="section-header">
                <span class="section-icon">ğŸš€</span>
                <h2 class="section-title">Patterns RLS AvancÃ©s</h2>
            </div>
            
            <h3 style="color: var(--primary); margin: 1.5rem 0 1rem;">Pattern 1 : RLS avec Many-to-Many</h3>
            
            <div class="code-block">
<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCÃ‰NARIO : User peut voir plusieurs rÃ©gions
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Table : UserRegions (Many-to-Many)</span>
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Email            â•‘ Region   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•£
â•‘ john@c.com       â•‘ France   â•‘
â•‘ john@c.com       â•‘ Belgium  â•‘ <span class="code-comment">// John voit 2 rÃ©gions</span>
â•‘ marie@c.com      â•‘ Germany  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•

<span class="code-comment">// RÃ´le DAX sur DimGeography:</span>

[Region] <span class="code-keyword">IN</span> 
    <span class="code-function">CALCULATETABLE</span>(
        <span class="code-function">VALUES</span>(UserRegions[Region]),
        UserRegions[Email] = <span class="code-function">USERPRINCIPALNAME</span>()
    )
            </div>
            
            <h3 style="color: var(--primary); margin: 2rem 0 1rem;">Pattern 2 : RLS Temporel</h3>
            
            <div class="code-block">
<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCÃ‰NARIO : Limiter accÃ¨s aux donnÃ©es rÃ©centes
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Table : UserAccess</span>
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Email            â•‘ MonthsHistory    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ intern@c.com     â•‘ 3                â•‘ <span class="code-comment">// 3 derniers mois</span>
â•‘ manager@c.com    â•‘ 12               â•‘ <span class="code-comment">// 12 derniers mois</span>
â•‘ director@c.com   â•‘ 999              â•‘ <span class="code-comment">// Tout l'historique</span>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

<span class="code-comment">// RÃ´le DAX sur Calendar:</span>

<span class="code-keyword">VAR</span> UserEmail = <span class="code-function">USERPRINCIPALNAME</span>()
<span class="code-keyword">VAR</span> AllowedMonths = 
    <span class="code-function">LOOKUPVALUE</span>(
        UserAccess[MonthsHistory],
        UserAccess[Email], UserEmail
    )
<span class="code-keyword">VAR</span> CutoffDate = 
    <span class="code-function">EDATE</span>(<span class="code-function">TODAY</span>(), -AllowedMonths)
<span class="code-keyword">RETURN</span>
    [Date] >= CutoffDate
            </div>
            
            <h3 style="color: var(--primary); margin: 2rem 0 1rem;">Pattern 3 : RLS avec Budget/Actual</h3>
            
            <div class="code-block">
<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCÃ‰NARIO : Certains users voient Budget, d'autres non
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Table : UserPermissions</span>
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Email            â•‘ CanSeeBudget     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ analyst@c.com    â•‘ FALSE            â•‘
â•‘ manager@c.com    â•‘ TRUE             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

<span class="code-comment">// RÃ´le DAX sur FactSales (si Budget dans mÃªme table):</span>

<span class="code-keyword">VAR</span> UserEmail = <span class="code-function">USERPRINCIPALNAME</span>()
<span class="code-keyword">VAR</span> CanSeeBudget = 
    <span class="code-function">LOOKUPVALUE</span>(
        UserPermissions[CanSeeBudget],
        UserPermissions[Email], UserEmail
    )
<span class="code-keyword">RETURN</span>
    <span class="code-function">IF</span>(
        CanSeeBudget,
        <span class="code-keyword">TRUE</span>(),              <span class="code-comment">// Voit tout (Actual + Budget)</span>
        [Type] = <span class="code-string">"Actual"</span>     <span class="code-comment">// Voit uniquement Actual</span>
    )
            </div>
        </section>
        
        <!-- TESTING RLS -->
        <section class="section">
            <div class="section-header">
                <span class="section-icon">ğŸ§ª</span>
                <h2 class="section-title">Tester RLS</h2>
            </div>
            
            <h3 style="color: var(--primary); margin: 1.5rem 0 1rem;">Dans Power BI Desktop</h3>
            
            <div class="code-block">
<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// METHOD 1 : View as Roles
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Modeling > View as</span>
<span class="code-comment">// â˜‘ RÃ´le: "Dynamic RLS"</span>
<span class="code-comment">// â˜‘ Other user: john@company.com</span>

<span class="code-comment">// â†’ Visuel filtre automatiquement comme si john@company.com connectÃ©</span>

<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// METHOD 2 : Mesure de test
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-keyword">RLS Test - Current User</span> = <span class="code-function">USERPRINCIPALNAME</span>()

<span class="code-keyword">RLS Test - Allowed Regions</span> = 
<span class="code-function">CONCATENATEX</span>(
    <span class="code-function">VALUES</span>(DimGeography[Region]),
    DimGeography[Region],
    <span class="code-string">", "</span>
)

<span class="code-comment">// Afficher ces mesures dans Card pour vÃ©rifier filtres actifs</span>
            </div>
            
            <h3 style="color: var(--primary); margin: 2rem 0 1rem;">Dans Power BI Service</h3>
            
            <div class="code-block">
<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‰TAPE 1 : Test avec "Test as Role"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Power BI Service > Dataset > Security
// Cliquer sur "..." Ã  cÃ´tÃ© du rÃ´le > Test as role
// Entrer email: john@company.com
// â†’ Preview du rapport avec RLS appliquÃ©</span>

<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‰TAPE 2 : Test en situation rÃ©elle
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// 1. Publier rapport
// 2. Assigner test user au rÃ´le
// 3. Se connecter avec compte test
// 4. VÃ©rifier donnÃ©es visibles</span>
            </div>
        </section>
        
        <!-- BEST PRACTICES RLS -->
        <section class="section">
            <div class="section-header">
                <span class="section-icon">âœ…</span>
                <h2 class="section-title">Best Practices RLS</h2>
            </div>
            
            <div class="options-grid">
                <div class="option-card">
                    <div class="option-name">1. RLS sur Dimensions, pas Facts</div>
                    <div class="option-description">Appliquer filtres sur DimGeography, pas FactSales</div>
                    <div class="option-relevance">â†’ Plus performant, Ã©vite calculs rÃ©pÃ©tÃ©s</div>
                </div>
                
                <div class="option-card">
                    <div class="option-name">2. PrÃ©fÃ©rer RLS Dynamique</div>
                    <div class="option-description">1 rÃ´le avec DAX vs 100 rÃ´les statiques</div>
                    <div class="option-relevance">â†’ MaintenabilitÃ© et scalabilitÃ©</div>
                </div>
                
                <div class="option-card">
                    <div class="option-name">3. Table de Mapping SÃ©parÃ©e</div>
                    <div class="option-description">UserRegionMapping distincte, pas dans dimensions</div>
                    <div class="option-relevance">â†’ Facilite gestion et mises Ã  jour</div>
                </div>
                
                <div class="option-card">
                    <div class="option-name">4. Toujours Tester AVANT Prod</div>
                    <div class="option-description">Test as role + test users rÃ©els</div>
                    <div class="option-relevance">â†’ Ã‰viter fuites de donnÃ©es</div>
                </div>
                
                <div class="option-card">
                    <div class="option-name">5. Documenter RÃ¨gles RLS</div>
                    <div class="option-description">Qui voit quoi ? Pourquoi ?</div>
                    <div class="option-relevance">â†’ Maintenance et audit</div>
                </div>
                
                <div class="option-card">
                    <div class="option-name">6. PrÃ©voir RÃ´le Admin</div>
                    <div class="option-description">Certains users doivent tout voir</div>
                    <div class="option-relevance">â†’ Region = "*" ou IsAdmin flag</div>
                </div>
            </div>
        </section>
        
        <!-- AUTRES SÃ‰CURITÃ‰S -->
        <section class="section">
            <div class="section-header">
                <span class="section-icon">ğŸ”</span>
                <h2 class="section-title">Autres Aspects SÃ©curitÃ©</h2>
            </div>
            
            <h3 style="color: var(--primary); margin: 1.5rem 0 1rem;">Object-Level Security (OLS)</h3>
            
            <div class="code-block">
<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MASQUER colonnes/tables sensibles
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Dans Power BI Desktop:</span>
<span class="code-comment">// Clic droit sur colonne/table > Hide</span>

<span class="code-comment">// Ou dans Tabular Editor:</span>
<span class="code-comment">// Column > IsHidden = true</span>

<span class="code-comment">// Users ne verront PAS ces colonnes dans champs</span>

<span class="code-comment">// âš ï¸ ATTENTION : Hide â‰  Security
// Users techniques peuvent contourner avec DAX Studio
// Pour vraie sÃ©curitÃ© : RLS + Ne pas importer colonnes sensibles</span>
            </div>
            
            <h3 style="color: var(--primary); margin: 2rem 0 1rem;">Workspace Permissions</h3>
            
            <div class="options-grid">
                <div class="option-card">
                    <div class="option-name">Admin</div>
                    <div class="option-description">Tout : modifier, publier, gÃ©rer accÃ¨s</div>
                </div>
                
                <div class="option-card">
                    <div class="option-name">Member</div>
                    <div class="option-description">Publier, modifier contenu</div>
                </div>
                
                <div class="option-card">
                    <div class="option-name">Contributor</div>
                    <div class="option-description">Modifier contenu existant, pas publier nouveau</div>
                </div>
                
                <div class="option-card">
                    <div class="option-name">Viewer</div>
                    <div class="option-description">Lecture seule (+ RLS si dÃ©fini)</div>
                </div>
            </div>
            
            <h3 style="color: var(--primary); margin: 2rem 0 1rem;">Credentials & Data Sources</h3>
            
            <div class="info-box info-box-warning">
                <div class="info-box-title">ğŸ”‘ Gestion Credentials</div>
                <ul style="margin-left: 1.5rem;">
                    <li>âœ… <strong>Service Principal</strong> : Pour connexions automatisÃ©es</li>
                    <li>âœ… <strong>OAuth2</strong> : Pour sources cloud (Azure SQL, etc.)</li>
                    <li>âœ… <strong>Gateway</strong> : Pour sources on-premise sÃ©curisÃ©es</li>
                    <li>âŒ <strong>JAMAIS</strong> hardcoder credentials dans M ou DAX</li>
                    <li>âŒ <strong>JAMAIS</strong> partager credentials via email/chat</li>
                </ul>
            </div>
            
            <h3 style="color: var(--primary); margin: 2rem 0 1rem;">Audit & Monitoring</h3>
            
            <div class="code-block">
<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACTIVER AUDIT LOGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Admin Portal > Audit logs > Enable
// Permet tracer:
// - Qui a consultÃ© quel rapport
// - Qui a modifiÃ© quoi
// - Tentatives d'accÃ¨s refusÃ©es
// - Export de donnÃ©es</span>

<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USAGE METRICS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-comment">// Workspace > Settings > Usage Metrics Report
// Active rapport auto sur:
// - Nombre vues par rapport
// - Utilisateurs actifs
// - MÃ©thodes d'accÃ¨s (Web, Mobile, API)</span>
            </div>
        </section>
        
        <!-- TROUBLESHOOTING -->
        <section class="section">
            <div class="section-header">
                <span class="section-icon">ğŸ”§</span>
                <h2 class="section-title">Troubleshooting RLS</h2>
            </div>
            
            <h3 style="color: var(--primary); margin: 1.5rem 0 1rem;">ProblÃ¨mes Courants</h3>
            
            <div class="options-grid">
                <div class="option-card">
                    <div class="option-name">âŒ User voit tout</div>
                    <div class="option-description">RLS pas assignÃ© dans Service</div>
                    <div class="option-relevance">â†’ VÃ©rifier Dataset > Security > Membres rÃ´le</div>
                </div>
                
                <div class="option-card">
                    <div class="option-name">âŒ User ne voit rien</div>
                    <div class="option-description">Filtre RLS trop restrictif ou email incorrect</div>
                    <div class="option-relevance">â†’ VÃ©rifier USERPRINCIPALNAME() retourne bon email</div>
                </div>
                
                <div class="option-card">
                    <div class="option-name">âŒ Visuels vides aprÃ¨s RLS</div>
                    <div class="option-description">Relation cassÃ©e ou mauvaise table filtrÃ©e</div>
                    <div class="option-relevance">â†’ RLS doit Ãªtre sur dimension, pas fact</div>
                </div>
                
                <div class="option-card">
                    <div class="option-name">âŒ Performances lentes</div>
                    <div class="option-description">DAX RLS complexe avec LOOKUPVALUE imbriquÃ©s</div>
                    <div class="option-relevance">â†’ Simplifier logique, utiliser relations</div>
                </div>
            </div>
            
            <h3 style="color: var(--primary); margin: 2rem 0 1rem;">Debug RLS</h3>
            
            <div class="code-block">
<span class="code-comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MESURE DEBUG : Qui suis-je ?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="code-keyword">DEBUG - Current User</span> = <span class="code-function">USERPRINCIPALNAME</span>()

<span class="code-keyword">DEBUG - Is Admin</span> = 
<span class="code-function">IF</span>(
    <span class="code-function">USERPRINCIPALNAME</span>() = <span class="code-string">"admin@company.com"</span>,
    <span class="code-string">"YES"</span>,
    <span class="code-string">"NO"</span>
)

<span class="code-keyword">DEBUG - My Regions</span> = 
<span class="code-function">CONCATENATEX</span>(
    <span class="code-function">CALCULATETABLE</span>(
        <span class="code-function">VALUES</span>(UserRegions[Region]),
        UserRegions[Email] = <span class="code-function">USERPRINCIPALNAME</span>()
    ),
    UserRegions[Region],
    <span class="code-string">", "</span>
)

<span class="code-comment">// Afficher ces mesures en Card sur page de test</span>
<span class="code-comment">// â†’ VÃ©rifier valeurs correctes pour chaque user</span>
            </div>
        </section>
    </div>
    
    <footer class="page-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>ğŸ“š Documentation</h4>
                <ul class="footer-links">
                    <li><a href="index.html">Accueil</a></li>
                    <li><a href="best-practices-project.html">Best Practices Projet</a></li>
                </ul>
            </div>
        </div>
    </footer>
</body>
</html>
